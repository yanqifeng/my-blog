# 浏览器缓存
浏览器缓存保存着用户通过 HTTP 获取的所有资源，在下一次请求时可以避免重复向服务器发出多余的请求。

## 浏览器缓存分类
* 强缓存
* 协商缓存（对比缓存）

### 强缓存
1. 查看 header 头中的 Expire（绝对时间） 和 Cache-control（相对时间） 来判断是否满足规则。
2. 满足规则，返回缓存数据
3. 不满足规则，向服务器发送请求
4. 服务器返回数据
5. 将新数据存入缓存

#### Expire
表示缓存到期时间

#### Cache-control
Cache-control 的优先级更高一点。有以下几个属性：
* max-age：表示资源缓存的最大有效时间
* no-cache：需要进行协商缓存，发送请求到服务器确认是否使用缓存
* no-store：禁止使用缓存，每一次都要重新请求数据
* public：默认设置
* private：不能被多用户共享

### 协商缓存
强缓存没有命中的时候，浏览器就会发送请求到服务器，服务器根据请求头中的部分信息来判断是否命中缓存。如果命中，则返回304

### Last-Modified If-Modified-Since
浏览器第一次请求资源的时候，服务器返回的 header 上会带有一个 Last-Modified 字段，表示资源最后修改的时间。

当浏览器再次请求该资源时，请求头中会带有一个 If-Modified-Since 字段，这个值是上一次返回的 Last-Modified。服务器收到请求后，将这个值与当前的 Last-Modified 进行对比。如果相等，则说明未修改，返回304。
缺点：
* 最小单位是秒，如果在短时间修改资源，Last-Modified 不会改变
* 周期性变化。如果资源在一个周期内修改回原来的样子了，我们认为是可以使用缓存的，但是 Last-Modified 已经修改了

所以，又引入了Etag

### Etag
Etag 一般是由文件内容 hash 生成的，可以保证资源的唯一性。

浏览器在第一次请求时，会返回Etag标识。当再次请求时，会通过 If-no-match 字段将 Etag 发送回服务器进行比较。

Last-Modified 和 Etag 可以同时设置，但是服务器优先校验 Etag，如果 Etag 相同就会继续对比 Last-Modified。